# The specification generator

The specification generator is a collection of tools to generate different artifacts based on the output of the OSLO tool EA-to-RDF.

The tools are
 - json-ld-generator.js: a tool to generate a complete json-ld context file for the output
 - exampletemplate-generator.js: this tool generates a json-ld context and default payload structure for each class in the specification.
 - html-generator.js: this tool generates html to be rendered by a static webpage server. The main target is Data.vlaanderen.be. The default templates to be used are found in the directory /views
 - shacl-generator.js: this tool generates SHACL templates
 
In addition some closely related tools are:
 - csv-renderer.js: this tool renders the content of a csv file according to a template generated by the exampletemplate-generator.
 - pretty-print.js: a tool to sort and pretty print the content of EA-to-RDF to create more stability in the saved artifacts created by the generators.

## build

This is a node.js project for node >= version 10.

```
npm set unsafe-perm true
npm install
```

The easiest method is the build it as a docker container using as Dockerfile  `Dockerfile.circleci`.

## Running the tools
To run any of the tools is done on the commandline as:
```
> node <tool>.js --help
```
which will give a short help about the tool.


## code style
In the node configuration the javascript code style is implemented in the test script using eslint.



## Strucutre of this repository

## Specification generator JS version
To minimize the impact of a different implementation language for the specification generator we will leave the templating engine untouched from an external perspective. The python implementation used Jinja2. We will use nunchucks.js for this version.

### necessary changes to the templates compared to the python implementation of nunjuncks.

The encountered differences between the python and javascript implementation are:
#### absence of a variable that is undergoing filtering
When a filter (selectattr, lower, ...) is used on a non existent variable then the template will crash. The solution here is to test the presence of the variable prior to filtering:
```
{% if object.property %}
  {{ object.property | lower }}
{% endif %}
```
#### lower() empty parameter method call not supported
In jinja the following construct is valid
```
# NOT SUPPORTED IN NUNJUCKS
{{ "TEST".lower()}}
```
for nunchucks this needs to be written as a 'true' filter such as
```
{{ "TEST" | lower }}
```

#### the complex form of the selectattr filter is not supported
The Jinja2 selectattr filter is not supported in the complex case. The simple case is supported though;
In jinja2 the following would filter out all object for which the property is set to 1
```
# NOT SUPPORTED IN NUNJUCKS
{{ objects | selectattr('property', 'equalto', 1)}}
```

The simple case of this filter is similar but wil only test for truthy values ( property in object && object.property != false ). This would look like:
```
{{ objects | selectattr('property')}}
```
To handle the complex case in nunjucks the following construct, base on groupings will work:
```
{% for property, objects in objects | groupby(property) %}
  {% if property == 1 %}
    # handle the filtered objects here
  {% endif %}
{% endfor %}
```

#### Autoescaping is enabled
For all templates, the given variables (the values of the jsonld) will be autoescaped. This means any characters that might be interpreted (e.g. '<', '>', ...) will be replaced with a neutral string and displayed as such. Autoescaping is currently deactivated for the usage values and can be for any variable if the safe filter is added. Doing so requires all entered values to be html safe and might cause errors if they are not.
```
{{ entity.usage[language] | safe }}
```